<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDV Moderno - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f8961e;
            --danger-color: #f72585;
            --gray-color: #adb5bd;
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            display: flex;
            min-height: 100vh;
            background-color: #f5f7fa;
            color: var(--dark-color);
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            z-index: 100;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .sidebar-header h3 {
            color: var(--primary-color);
            font-weight: 700;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-menu li {
            list-style: none;
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--dark-color);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            border-left: 3px solid var(--primary-color);
        }

        .sidebar-menu a.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            border-left: 3px solid var(--primary-color);
        }

        .sidebar-menu i {
            margin-right: 10px;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: all 0.3s;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header h2 {
            color: var(--dark-color);
            font-weight: 500;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-header h3 {
            font-size: 16px;
            font-weight: 500;
            color: var(--gray-color);
        }

        .card-header i {
            font-size: 20px;
            color: var(--gray-color);
        }

        .card-body h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-body p {
            font-size: 14px;
            color: var(--gray-color);
        }

        .card.today-sales {
            border-left: 4px solid var(--primary-color);
        }

        .card.today-profit {
            border-left: 4px solid var(--success-color);
        }

        .card.month-sales {
            border-left: 4px solid var(--warning-color);
        }

        .card.month-profit {
            border-left: 4px solid var(--danger-color);
        }

        /* Charts */
        .chart-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            font-size: 18px;
            font-weight: 500;
        }

        .chart-filters {
            display: flex;
            gap: 10px;
        }

        .chart-filters button {
            padding: 8px 15px;
            border: none;
            background-color: var(--light-color);
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .chart-filters button.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        th {
            font-weight: 500;
            color: var(--gray-color);
        }

        tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status.completed {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
        }

        .status.pending {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning-color);
        }

        .status.canceled {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger-color);
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            margin-right: 5px;
        }

        .action-btn.edit {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .action-btn.delete {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--danger-color);
        }

        .action-btn:hover {
            opacity: 0.8;
        }

        /* Forms */
        .form-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background-color: var(--gray-color);
            color: white;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Sales Panel */
        .sales-panel {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .products-list {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            max-height: 600px;
            overflow-y: auto;
        }

        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .product-item:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .product-info h4 {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .product-info p {
            font-size: 12px;
            color: var(--gray-color);
        }

        .product-price {
            font-weight: 700;
            color: var(--primary-color);
        }

        .cart-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .cart-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .cart-items {
            flex: 1;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .cart-item-info {
            display: flex;
            align-items: center;
        }

        .cart-item-quantity {
            width: 30px;
            text-align: center;
            margin: 0 10px;
        }

        .cart-item-price {
            font-weight: 500;
        }

        .cart-item-remove {
            color: var(--danger-color);
            cursor: pointer;
            margin-left: 10px;
        }

        .cart-total {
            padding: 15px 0;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-total h3 {
            font-weight: 500;
        }

        .cart-total-price {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .payment-methods {
            margin-bottom: 20px;
        }

        .payment-method {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .payment-method input {
            margin-right: 10px;
        }

        .discount-input {
            display: flex;
            margin-bottom: 20px;
        }

        .discount-input input {
            flex: 1;
            margin-right: 10px;
        }

        .customer-search {
            margin-bottom: 20px;
        }

        /* Receipt */
        .receipt {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: 0 auto;
            font-family: 'Courier New', monospace;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px dashed #000;
            padding-bottom: 10px;
        }

        .receipt-header h2 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .receipt-header p {
            font-size: 12px;
            margin-bottom: 5px;
        }

        .receipt-body {
            margin-bottom: 20px;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .receipt-total {
            border-top: 1px dashed #000;
            padding-top: 10px;
            margin-top: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }

        .receipt-footer {
            text-align: center;
            font-size: 12px;
            margin-top: 20px;
            border-top: 1px dashed #000;
            padding-top: 10px;
        }

        /* Service Order */
        .service-order {
            background-color: white;
            padding: 30px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .service-order-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .service-order-header h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .service-order-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .service-order-info-item h4 {
            margin-bottom: 10px;
            font-weight: 500;
        }

        .service-order-description {
            margin-bottom: 30px;
        }

        .service-order-items {
            margin-bottom: 30px;
        }

        .service-order-signature {
            margin-top: 50px;
            text-align: center;
        }

        .service-order-signature-line {
            width: 300px;
            border-top: 1px solid #000;
            margin: 0 auto 10px;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sales-panel {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                z-index: 1000;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .menu-toggle {
                display: block;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray-color);
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            cursor: pointer;
            color: var(--danger-color);
            background: none;
            border: none;
            font-weight: bold;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .receipt, .receipt *,
            .service-order, .service-order * {
                visibility: visible;
            }
            .receipt,
            .service-order {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                max-width: 100%;
                box-shadow: none;
                margin: 0;
                padding: 20px;
            }
            .no-print {
                display: none !important;
            }
        }

        /* Mask for phone and CPF */
        .phone-mask {
            font-family: 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>Modo Mobile Sistema</h3>
        </div>
        <ul class="sidebar-menu">
            <li>
                <a href="#" class="active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="#" data-section="sales">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Vendas</span>
                </a>
            </li>
            <li>
                <a href="#" data-section="customers">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
            </li>
            <li>
                <a href="#" data-section="products">
                    <i class="fas fa-box-open"></i>
                    <span>Produtos</span>
                </a>
            </li>
            <li>
                <a href="#" data-section="service-orders">
                    <i class="fas fa-tools"></i>
                    <span>Ordens de Serviço</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard-section">
            <div class="header">
                <h2>Dashboard</h2>
                <div class="user-info">
                    <img src="https://ui-avatars.com/api/?name=Admin" alt="User">
                    <span>Admin</span>
                </div>
            </div>

            <div class="cards">
                <div class="card today-sales">
                    <div class="card-header">
                        <h3>Vendas Hoje</h3>
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                    <div class="card-body">
                        <h2 id="today-sales-amount">R$ 0,00</h2>
                        <p>+0% em relação a ontem</p>
                    </div>
                </div>
                <div class="card today-profit">
                    <div class="card-header">
                        <h3>Lucro Hoje</h3>
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="card-body">
                        <h2 id="today-profit-amount">R$ 0,00</h2>
                        <p>+0% em relação a ontem</p>
                    </div>
                </div>
                <div class="card month-sales">
                    <div class="card-header">
                        <h3>Vendas Mês</h3>
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="card-body">
                        <h2 id="month-sales-amount">R$ 0,00</h2>
                        <p>+0% em relação ao mês passado</p>
                    </div>
                </div>
                <div class="card month-profit">
                    <div class="card-header">
                        <h3>Lucro Mês</h3>
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="card-body">
                        <h2 id="month-profit-amount">R$ 0,00</h2>
                        <p>+0% em relação ao mês passado</p>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-header">
                    <h3>Desempenho de Vendas</h3>
                    <div class="chart-filters">
                        <button class="active" data-period="day">Dia</button>
                        <button data-period="week">Semana</button>
                        <button data-period="month">Mês</button>
                    </div>
                </div>
                <canvas id="salesChart"></canvas>
            </div>

            <div class="table-container">
                <h3>Últimas Vendas</h3>
                <table id="recent-sales-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados serão preenchidos via JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Sales Section -->
        <section id="sales-section" style="display: none;">
            <div class="header">
                <h2>Vendas</h2>
                <div class="user-info">
                    <img src="https://ui-avatars.com/api/?name=Admin" alt="User">
                    <span>Admin</span>
                </div>
            </div>

            <div class="sales-panel">
                <div class="products-list">
                    <div class="form-group">
                        <input type="text" class="form-control" id="product-search" placeholder="Buscar produtos...">
                    </div>
                    <div id="products-list-container">
                        <!-- Produtos serão preenchidos via JavaScript -->
                    </div>
                </div>

                <div class="cart-container">
                    <div class="cart-header">
                        <h3>Carrinho de Vendas</h3>
                    </div>
                    <div class="cart-items" id="cart-items">
                        <!-- Itens do carrinho serão preenchidos via JavaScript -->
                    </div>
                    <div class="cart-total">
                        <h3>Total</h3>
                        <span class="cart-total-price" id="cart-total">R$ 0,00</span>
                    </div>

                    <div class="discount-input">
                        <input type="text" class="form-control" id="discount-input" placeholder="Desconto">
                        <button class="btn btn-secondary" id="apply-discount">Aplicar</button>
                    </div>

                    <div class="payment-methods">
                        <h4>Forma de Pagamento</h4>
                        <div class="payment-method">
                            <input type="radio" id="cash" name="payment" value="Dinheiro" checked>
                            <label for="cash">Dinheiro</label>
                        </div>
                        <div class="payment-method">
                            <input type="radio" id="credit" name="payment" value="Crédito">
                            <label for="credit">Crédito</label>
                        </div>
                        <div class="payment-method">
                            <input type="radio" id="debit" name="payment" value="Débito">
                            <label for="debit">Débito</label>
                        </div>
                        <div class="payment-method">
                            <input type="radio" id="pix" name="payment" value="PIX">
                            <label for="pix">PIX</label>
                        </div>
                    </div>

                    <div class="customer-search">
                        <div class="form-group">
                            <label for="customer-search">Cliente</label>
                            <div style="display: flex;">
                                <input type="text" class="form-control" id="customer-search" placeholder="Buscar cliente...">
                                <button class="btn btn-secondary" id="new-customer-btn" style="margin-left: 10px;">Novo</button>
                            </div>
                            <div id="customer-search-results" style="display: none; margin-top: 10px; border: 1px solid #ddd; max-height: 200px; overflow-y: auto;"></div>
                        </div>
                    </div>

                    <button class="btn btn-primary" id="complete-sale">Finalizar Venda</button>
                </div>
            </div>

            <!-- Receipt Modal -->
            <div class="modal" id="receipt-modal">
                <div class="modal-content">
                    <button class="modal-close">&times;</button>
                    <div class="modal-header">
                        <h3>Recibo de Venda</h3>
                    </div>
                    <div class="receipt" id="receipt-content">
                        <div class="receipt-header">
                            <h2>PDV Moderno</h2>
                            <p>Rua Exemplo, 123 - Centro</p>
                            <p>São Paulo - SP</p>
                            <p>CNPJ: 12.345.678/0001-99</p>
                            <p>IE: 123.456.789.111</p>
                            <p>--------------------------------</p>
                            <p>Venda #<span id="receipt-id">0001</span></p>
                            <p>Data: <span id="receipt-date">01/01/2023 10:00</span></p>
                            <p>Cliente: <span id="receipt-customer">Consumidor Final</span></p>
                            <p>Atendente: Admin</p>
                            <p>--------------------------------</p>
                        </div>
                        <div class="receipt-body" id="receipt-items">
                            <!-- Itens serão preenchidos via JavaScript -->
                        </div>
                        <div class="receipt-total">
                            <span>Total:</span>
                            <span id="receipt-total">R$ 0,00</span>
                        </div>
                        <div class="receipt-footer">
                            <p>Forma de Pagamento: <span id="receipt-payment">Dinheiro</span></p>
                            <p>--------------------------------</p>
                            <p>Obrigado pela preferência!</p>
                            <p>Volte sempre!</p>
                        </div>
                    </div>
                    <div class="modal-footer no-print">
                        <button class="btn btn-danger modal-close">Fechar</button>
                        <button class="btn btn-primary" id="print-receipt">Imprimir</button>
                    </div>
                </div>
            </div>

            <!-- New Customer Modal -->
            <div class="modal" id="new-customer-modal">
                <div class="modal-content">
                    <button class="modal-close">&times;</button>
                    <div class="modal-header">
                        <h3>Novo Cliente</h3>
                    </div>
                    <div class="form-container">
                        <div class="form-group">
                            <label for="customer-name">Nome</label>
                            <input type="text" class="form-control" id="customer-name" placeholder="Nome completo">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customer-phone">Telefone</label>
                                <input type="text" class="form-control phone-mask" id="customer-phone" placeholder="(00) 00000-0000" maxlength="15">
                            </div>
                            <div class="form-group">
                                <label for="customer-cpf">CPF</label>
                                <input type="text" class="form-control" id="customer-cpf" placeholder="000.000.000-00" maxlength="14">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="customer-notes">Observações</label>
                            <textarea class="form-control" id="customer-notes" rows="3" placeholder="Observações sobre o cliente"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-danger modal-close">Cancelar</button>
                        <button class="btn btn-primary" id="save-customer">Salvar</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Customers Section -->
        <section id="customers-section" style="display: none;">
            <div class="header">
                <h2>Clientes</h2>
                <div class="user-info">
                    <img src="https://ui-avatars.com/api/?name=Admin" alt="User">
                    <span>Admin</span>
                </div>
            </div>

            <div class="table-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="form-group" style="flex: 1; margin-right: 20px;">
                        <input type="text" class="form-control" id="customer-table-search" placeholder="Buscar clientes...">
                    </div>
                    <button class="btn btn-primary" id="add-customer-btn">Adicionar Cliente</button>
                </div>
                <table id="customers-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Telefone</th>
                            <th>CPF</th>
                            <th>Total Compras</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados serão preenchidos via JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Customer Details Modal -->
            <div class="modal" id="customer-details-modal">
                <div class="modal-content" style="max-width: 800px;">
                    <button class="modal-close">&times;</button>
                    <div class="modal-header">
                        <h3>Detalhes do Cliente</h3>
                    </div>
                    <div class="tabs">
                        <div class="tab active" data-tab="info">Informações</div>
                        <div class="tab" data-tab="purchases">Histórico de Compras</div>
                        <div class="tab" data-tab="services">Ordens de Serviço</div>
                        <div class="tab" data-tab="notes">Anotações</div>
                    </div>
                    
                    <div id="customer-tab-info" class="tab-content active">
                        <div class="form-container">
                            <div class="form-group">
                                <label for="edit-customer-name">Nome</label>
                                <input type="text" class="form-control" id="edit-customer-name" placeholder="Nome completo">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="edit-customer-phone">Telefone</label>
                                    <input type="text" class="form-control phone-mask" id="edit-customer-phone" placeholder="(00) 00000-0000" maxlength="15">
                                </div>
                                <div class="form-group">
                                    <label for="edit-customer-cpf">CPF</label>
                                    <input type="text" class="form-control" id="edit-customer-cpf" placeholder="000.000.000-00" maxlength="14">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="customer-tab-purchases" class="tab-content" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Venda #</th>
                                    <th>Total</th>
                                    <th>Forma Pagamento</th>
                                </tr>
                            </thead>
                            <tbody id="customer-purchases-list">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="customer-tab-services" class="tab-content" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>OS #</th>
                                    <th>Problema</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="customer-services-list">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="customer-tab-notes" class="tab-content" style="display: none;">
                        <div class="form-group">
                            <textarea class="form-control" id="edit-customer-notes" rows="5" placeholder="Anotações sobre o cliente"></textarea>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button class="btn btn-danger" id="delete-customer-btn">Excluir Cliente</button>
                        <button class="btn btn-primary" id="update-customer-btn">Salvar Alterações</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section id="products-section" style="display: none;">
            <div class="header">
                <h2>Produtos</h2>
                <div class="user-info">
                    <img src="https://ui-avatars.com/api/?name=Admin" alt="User">
                    <span>Admin</span>
                </div>
            </div>

            <div class="table-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="form-group" style="flex: 1; margin-right: 20px;">
                        <input type="text" class="form-control" id="product-table-search" placeholder="Buscar produtos...">
                    </div>
                    <button class="btn btn-primary" id="add-product-btn">Adicionar Produto</button>
                </div>
                <table id="products-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Estoque</th>
                            <th>Estoque Ideal</th>
                            <th>Custo</th>
                            <th>Venda</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados serão preenchidos via JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Low Stock Warning -->
            <div class="table-container" style="margin-top: 30px;">
                <h3>Produtos com Estoque Baixo</h3>
                <table id="low-stock-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Estoque Atual</th>
                            <th>Estoque Ideal</th>
                            <th>Diferença</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados serão preenchidos via JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Product Modal -->
            <div class="modal" id="product-modal">
                <div class="modal-content">
                    <button class="modal-close">&times;</button>
                    <div class="modal-header">
                        <h3 id="product-modal-title">Adicionar Produto</h3>
                    </div>
                    <div class="form-container">
                        <div class="form-group">
                            <label for="product-name">Nome do Produto</label>
                            <input type="text" class="form-control" id="product-name" placeholder="Nome do produto">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="product-quantity">Quantidade Atual</label>
                                <input type="number" class="form-control" id="product-quantity" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="product-ideal-quantity">Quantidade Ideal</label>
                                <input type="number" class="form-control" id="product-ideal-quantity" placeholder="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="product-cost">Valor de Custo</label>
                                <input type="text" class="form-control" id="product-cost" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="product-price">Valor de Venda</label>
                                <input type="text" class="form-control" id="product-price" placeholder="R$ 0,00">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-danger modal-close">Cancelar</button>
                        <button class="btn btn-primary" id="save-product">Salvar</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Service Orders Section -->
        <section id="service-orders-section" style="display: none;">
            <div class="header">
                <h2>Ordens de Serviço</h2>
                <div class="user-info">
                    <img src="https://ui-avatars.com/api/?name=Admin" alt="User">
                    <span>Admin</span>
                </div>
            </div>

            <div class="table-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="form-group" style="flex: 1; margin-right: 20px;">
                        <input type="text" class="form-control" id="service-order-search" placeholder="Buscar ordens de serviço...">
                    </div>
                    <button class="btn btn-primary" id="add-service-order-btn">Nova Ordem</button>
                </div>
                <table id="service-orders-table">
                    <thead>
                        <tr>
                            <th>OS #</th>
                            <th>Cliente</th>
                            <th>Problema</th>
                            <th>Data</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados serão preenchidos via JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Service Order Modal -->
            <div class="modal" id="service-order-modal">
                <div class="modal-content" style="max-width: 800px;">
                    <button class="modal-close">&times;</button>
                    <div class="modal-header">
                        <h3 id="service-order-modal-title">Nova Ordem de Serviço</h3>
                    </div>
                    <div class="form-container">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="service-order-customer">Cliente</label>
                                <div style="display: flex;">
                                    <input type="text" class="form-control" id="service-order-customer-search" placeholder="Buscar cliente...">
                                    <button class="btn btn-secondary" id="service-order-new-customer-btn" style="margin-left: 10px;">Novo</button>
                                </div>
                                <div id="service-order-customer-search-results" style="display: none; margin-top: 10px; border: 1px solid #ddd; max-height: 200px; overflow-y: auto;"></div>
                            </div>
                            <div class="form-group">
                                <label for="service-order-date">Data</label>
                                <input type="date" class="form-control" id="service-order-date">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="service-order-problem">Descrição do Problema</label>
                            <textarea class="form-control" id="service-order-problem" rows="3" placeholder="Descreva o problema relatado pelo cliente"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="service-order-items">Itens Entregues</label>
                            <textarea class="form-control" id="service-order-items" rows="2" placeholder="Liste os itens entregues pelo cliente (celular, carregador, etc.)"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="service-order-estimated-value">Valor Estimado</label>
                                <input type="text" class="form-control" id="service-order-estimated-value" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="service-order-deadline">Prazo</label>
                                <input type="date" class="form-control" id="service-order-deadline">
                            </div>
                            <div class="form-group">
                                <label for="service-order-status">Status</label>
                                <select class="form-control" id="service-order-status">
                                    <option value="pending">Pendente</option>
                                    <option value="in_progress">Em Andamento</option>
                                    <option value="completed">Concluído</option>
                                    <option value="canceled">Cancelado</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-danger modal-close">Cancelar</button>
                        <button class="btn btn-primary" id="save-service-order">Salvar</button>
                        <button class="btn btn-success" id="print-service-order" style="display: none;">Imprimir</button>
                    </div>
                </div>
            </div>

            <!-- Service Order Print Preview -->
            <div class="modal" id="service-order-print-modal">
                <div class="modal-content" style="max-width: 800px;">
                    <button class="modal-close">&times;</button>
                    <div class="service-order" id="service-order-print-content">
                        <div class="service-order-header">
                            <h2>PDV Moderno</h2>
                            <p>Rua Exemplo, 123 - Centro - São Paulo - SP</p>
                            <p>Telefone: (11) 1234-5678 | Email: contato@pdvmoderno.com</p>
                            <h3 style="margin-top: 20px;">ORDEM DE SERVIÇO #<span id="print-os-id">0001</span></h3>
                        </div>
                        
                        <div class="service-order-info">
                            <div class="service-order-info-item">
                                <h4>Dados do Cliente</h4>
                                <p>Nome: <span id="print-customer-name">Cliente Exemplo</span></p>
                                <p>Telefone: <span id="print-customer-phone">(11) 98765-4321</span></p>
                                <p>CPF: <span id="print-customer-cpf">123.456.789-00</span></p>
                            </div>
                            <div class="service-order-info-item">
                                <h4>Dados do Serviço</h4>
                                <p>Data: <span id="print-os-date">01/01/2023</span></p>
                                <p>Prazo: <span id="print-os-deadline">10/01/2023</span></p>
                                <p>Status: <span id="print-os-status">Pendente</span></p>
                                <p>Valor: <span id="print-os-value">R$ 150,00</span></p>
                            </div>
                        </div>
                        
                        <div class="service-order-description">
                            <h4>Descrição do Problema</h4>
                            <p id="print-os-problem">Tela do celular quebrada, necessita substituição.</p>
                        </div>
                        
                        <div class="service-order-items">
                            <h4>Itens Entregues</h4>
                            <p id="print-os-items">iPhone XS, carregador original, cabo USB</p>
                        </div>
                        
                        <div class="service-order-signature">
                            <p>Assinatura do Cliente</p>
                            <div class="service-order-signature-line"></div>
                            <p id="print-customer-name-footer">Cliente Exemplo</p>
                        </div>
                    </div>
                    <div class="modal-footer no-print">
                        <button class="btn btn-danger modal-close">Fechar</button>
                        <button class="btn btn-primary" id="print-service-order-btn">Imprimir</button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Dados iniciais (simulando um banco de dados)
        let db = {
            sales: [],
            customers: [],
            products: [
                { id: 1, name: "iPhone 13", quantity: 5, idealQuantity: 10, cost: 4000, price: 5000 },
                { id: 2, name: "Samsung Galaxy S21", quantity: 3, idealQuantity: 8, cost: 3500, price: 4500 },
                { id: 3, name: "Capa iPhone 13", quantity: 15, idealQuantity: 20, cost: 50, price: 120 },
                { id: 4, name: "Película Vidro", quantity: 25, idealQuantity: 30, cost: 10, price: 40 },
                { id: 5, name: "Carregador USB-C", quantity: 8, idealQuantity: 15, cost: 30, price: 80 }
            ],
            serviceOrders: []
        };

        // Carregar dados do localStorage se existirem
        function loadData() {
            const savedData = localStorage.getItem('pdv-database');
            if (savedData) {
                db = JSON.parse(savedData);
                // Ordenar vendas por data (mais recente primeiro)
                db.sales.sort((a, b) => new Date(b.date) - new Date(a.date));
                // Ordenar clientes por nome (A-Z)
                db.customers.sort((a, b) => a.name.localeCompare(b.name));
            }
        }

        // Salvar dados no localStorage
        function saveData() {
            localStorage.setItem('pdv-database', JSON.stringify(db));
        }

        // Inicializar dados
        loadData();

        // Funções auxiliares
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('pt-BR');
        }

        function formatDateTime(date) {
            return new Date(date).toLocaleString('pt-BR');
        }

        function generateId() {
            return Math.floor(Math.random() * 1000000);
        }

        // Formatar telefone
        function formatPhone(phone) {
            if (!phone) return '';
            // Remove tudo que não é dígito
            const cleaned = phone.replace(/\D/g, '');
            // Aplica a formatação
            const match = cleaned.match(/^(\d{2})(\d{5})(\d{4})$/);
            if (match) {
                return `(${match[1]}) ${match[2]}-${match[3]}`;
            }
            return phone;
        }

        // Formatar CPF
        function formatCPF(cpf) {
            if (!cpf) return '';
            // Remove tudo que não é dígito
            const cleaned = cpf.replace(/\D/g, '');
            // Aplica a formatação
            const match = cleaned.match(/^(\d{3})(\d{3})(\d{3})(\d{2})$/);
            if (match) {
                return `${match[1]}.${match[2]}.${match[3]}-${match[4]}`;
            }
            return cpf;
        }

        // Máscara para telefone
        function applyPhoneMask(input) {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 11) value = value.substring(0, 11);
                
                if (value.length > 0) {
                    value = `(${value.substring(0, 2)}) ${value.substring(2, 7)}-${value.substring(7, 11)}`;
                }
                
                e.target.value = value;
            });
        }

        // Máscara para CPF
        function applyCPFMask(input) {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 11) value = value.substring(0, 11);
                
                if (value.length > 0) {
                    value = `${value.substring(0, 3)}.${value.substring(3, 6)}.${value.substring(6, 9)}-${value.substring(9, 11)}`;
                }
                
                e.target.value = value;
            });
        }

        // Navegação entre seções
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remover classe active de todos os links
                document.querySelectorAll('.sidebar-menu a').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Adicionar classe active ao link clicado
                this.classList.add('active');
                
                // Esconder todas as seções
                document.querySelectorAll('section').forEach(section => {
                    section.style.display = 'none';
                });
                
                // Mostrar a seção correspondente
                const sectionId = this.getAttribute('data-section') + '-section';
                document.getElementById(sectionId).style.display = 'block';
                
                // Atualizar dados da seção
                updateSectionData(this.getAttribute('data-section'));
            });
        });

        // Atualizar dados da seção
        function updateSectionData(section) {
            switch(section) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'sales':
                    updateSalesSection();
                    break;
                case 'customers':
                    updateCustomersSection();
                    break;
                case 'products':
                    updateProductsSection();
                    break;
                case 'service-orders':
                    updateServiceOrdersSection();
                    break;
            }
        }

        // Dashboard
        function updateDashboard() {
            // Atualizar cards
            const today = new Date().toISOString().split('T')[0];
            const month = new Date().getMonth() + 1;
            const year = new Date().getFullYear();
            
            const todaySales = db.sales.filter(sale => sale.date.includes(today));
            const monthSales = db.sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate.getMonth() + 1 === month && saleDate.getFullYear() === year;
            });
            
            const todaySalesAmount = todaySales.reduce((total, sale) => total + sale.total, 0);
            const todayProfitAmount = todaySales.reduce((total, sale) => total + sale.profit, 0);
            const monthSalesAmount = monthSales.reduce((total, sale) => total + sale.total, 0);
            const monthProfitAmount = monthSales.reduce((total, sale) => total + sale.profit, 0);
            
            document.getElementById('today-sales-amount').textContent = formatCurrency(todaySalesAmount);
            document.getElementById('today-profit-amount').textContent = formatCurrency(todayProfitAmount);
            document.getElementById('month-sales-amount').textContent = formatCurrency(monthSalesAmount);
            document.getElementById('month-profit-amount').textContent = formatCurrency(monthProfitAmount);
            
            // Atualizar gráfico
            updateSalesChart('day');
            
            // Atualizar tabela de vendas recentes
            const recentSalesTable = document.getElementById('recent-sales-table').querySelector('tbody');
            recentSalesTable.innerHTML = '';
            
            const recentSales = db.sales.slice(0, 5);
            recentSales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.id}</td>
                    <td>${formatDateTime(sale.date)}</td>
                    <td>${sale.customer ? sale.customer.name : 'Consumidor Final'}</td>
                    <td>${formatCurrency(sale.total)}</td>
                    <td><span class="status completed">Concluída</span></td>
                    <td>
                        <button class="action-btn edit" data-id="${sale.id}"><i class="fas fa-eye"></i></button>
                        <button class="action-btn delete" data-id="${sale.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                recentSalesTable.appendChild(row);
            });

            // Adicionar eventos para editar/excluir vendas
            document.querySelectorAll('#recent-sales-table .action-btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const saleId = parseInt(this.getAttribute('data-id'));
                    const sale = db.sales.find(s => s.id === saleId);
                    if (sale) {
                        showReceipt(sale);
                    }
                });
            });

            document.querySelectorAll('#recent-sales-table .action-btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const saleId = parseInt(this.getAttribute('data-id'));
                    if (confirm('Tem certeza que deseja excluir esta venda?')) {
                        db.sales = db.sales.filter(s => s.id !== saleId);
                        saveData();
                        updateDashboard();
                    }
                });
            });
        }

        // Gráfico de vendas
        let salesChart;
        function updateSalesChart(period) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            // Dados fictícios para demonstração
            let labels, salesData, profitData;
            
            if (period === 'day') {
                labels = ['08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'];
                salesData = [500, 1200, 800, 1500, 2000, 1800, 1000];
                profitData = [200, 500, 300, 600, 800, 700, 400];
            } else if (period === 'week') {
                labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
                salesData = [3500, 4200, 3800, 4500, 5000, 6000, 4000];
                profitData = [1400, 1700, 1500, 1800, 2000, 2400, 1600];
            } else {
                labels = ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'];
                salesData = [15000, 18000, 20000, 22000];
                profitData = [6000, 7200, 8000, 8800];
            }
            
            if (salesChart) {
                salesChart.destroy();
            }
            
            salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Vendas',
                            data: salesData,
                            borderColor: '#4361ee',
                            backgroundColor: 'rgba(67, 97, 238, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Lucro',
                            data: profitData,
                            borderColor: '#4cc9f0',
                            backgroundColor: 'rgba(76, 201, 240, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Filtros do gráfico
        document.querySelectorAll('.chart-filters button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.chart-filters button').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                updateSalesChart(this.getAttribute('data-period'));
            });
        });

        // Seção de Vendas
        let currentCart = {
            items: [],
            discount: 0,
            paymentMethod: 'Dinheiro',
            customer: null
        };

        function updateSalesSection() {
            // Atualizar lista de produtos
            const productsList = document.getElementById('products-list-container');
            productsList.innerHTML = '';
            
            db.products.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                productItem.setAttribute('data-id', product.id);
                productItem.innerHTML = `
                    <div class="product-info">
                        <h4>${product.name}</h4>
                        <p>Estoque: ${product.quantity}</p>
                    </div>
                    <div class="product-price">${formatCurrency(product.price)}</div>
                `;
                productsList.appendChild(productItem);
                
                // Adicionar evento de clique para adicionar ao carrinho
                productItem.addEventListener('click', function() {
                    addToCart(product);
                });
            });
            
            // Atualizar carrinho
            updateCart();
            
            // Busca de produtos
            document.getElementById('product-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                document.querySelectorAll('.product-item').forEach(item => {
                    const productName = item.querySelector('h4').textContent.toLowerCase();
                    if (productName.includes(searchTerm)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
            
            // Busca de clientes
            document.getElementById('customer-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const resultsContainer = document.getElementById('customer-search-results');
                
                if (searchTerm.length < 2) {
                    resultsContainer.style.display = 'none';
                    return;
                }
                
                const filteredCustomers = db.customers.filter(customer => 
                    customer.name.toLowerCase().includes(searchTerm) || 
                    (customer.phone && customer.phone.includes(searchTerm)) ||
                    (customer.cpf && customer.cpf.includes(searchTerm))
                );
                
                if (filteredCustomers.length > 0) {
                    resultsContainer.innerHTML = '';
                    filteredCustomers.forEach(customer => {
                        const div = document.createElement('div');
                        div.className = 'product-item';
                        div.style.padding = '10px';
                        div.style.cursor = 'pointer';
                        div.innerHTML = `
                            <div class="product-info">
                                <h4>${customer.name}</h4>
                                <p>${customer.phone || ''} ${customer.cpf || ''}</p>
                            </div>
                        `;
                        div.addEventListener('click', function() {
                            currentCart.customer = customer;
                            document.getElementById('customer-search').value = customer.name;
                            resultsContainer.style.display = 'none';
                        });
                        resultsContainer.appendChild(div);
                    });
                    resultsContainer.style.display = 'block';
                } else {
                    resultsContainer.innerHTML = '<div style="padding: 10px;">Nenhum cliente encontrado</div>';
                    resultsContainer.style.display = 'block';
                }
            });
            
            // Novo cliente
            document.getElementById('new-customer-btn').addEventListener('click', function() {
                document.getElementById('new-customer-modal').style.display = 'flex';
                document.getElementById('customer-name').value = '';
                document.getElementById('customer-phone').value = '';
                document.getElementById('customer-cpf').value = '';
                document.getElementById('customer-notes').value = '';
            });
            
            // Aplicar máscaras aos campos de telefone e CPF
            applyPhoneMask(document.getElementById('customer-phone'));
            applyCPFMask(document.getElementById('customer-cpf'));
            
            // Fechar modal
            document.querySelectorAll('.modal-close').forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Salvar cliente
            document.getElementById('save-customer').addEventListener('click', function() {
                const name = document.getElementById('customer-name').value;
                const phone = document.getElementById('customer-phone').value;
                const cpf = document.getElementById('customer-cpf').value;
                const notes = document.getElementById('customer-notes').value;
                
                if (!name) {
                    alert('Por favor, informe o nome do cliente');
                    return;
                }
                
                const newCustomer = {
                    id: generateId(),
                    name,
                    phone,
                    cpf,
                    notes,
                    purchases: [],
                    serviceOrders: []
                };
                
                db.customers.push(newCustomer);
                saveData();
                
                // Limpar formulário
                document.getElementById('customer-name').value = '';
                document.getElementById('customer-phone').value = '';
                document.getElementById('customer-cpf').value = '';
                document.getElementById('customer-notes').value = '';
                
                // Fechar modal
                document.getElementById('new-customer-modal').style.display = 'none';
                
                // Atualizar cliente no carrinho
                currentCart.customer = newCustomer;
                document.getElementById('customer-search').value = newCustomer.name;
                
                alert('Cliente cadastrado com sucesso!');
            });
            
            // Aplicar desconto
            document.getElementById('apply-discount').addEventListener('click', function() {
                const discountInput = document.getElementById('discount-input').value;
                const discount = parseFloat(discountInput.replace(',', '.')) || 0;
                
                if (discount < 0) {
                    alert('O desconto não pode ser negativo');
                    return;
                }
                
                currentCart.discount = discount;
                updateCart();
            });
            
            // Finalizar venda
            document.getElementById('complete-sale').addEventListener('click', function() {
                if (currentCart.items.length === 0) {
                    alert('Adicione produtos ao carrinho antes de finalizar a venda');
                    return;
                }
                
                const total = currentCart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const discount = currentCart.discount;
                const finalTotal = total - discount;
                const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
                
                // Calcular lucro
                const profit = currentCart.items.reduce((sum, item) => {
                    const product = db.products.find(p => p.id === item.id);
                    return sum + ((item.price - product.cost) * item.quantity);
                }, 0) - discount;
                
                // Criar venda
                const newSale = {
                    id: generateId(),
                    date: new Date().toISOString(),
                    items: [...currentCart.items],
                    total: finalTotal,
                    discount,
                    paymentMethod,
                    profit,
                    customer: currentCart.customer
                };
                
                // Adicionar ao banco de dados
                db.sales.unshift(newSale); // Adiciona no início para ordenação
                
                // Atualizar estoque
                newSale.items.forEach(item => {
                    const product = db.products.find(p => p.id === item.id);
                    if (product) {
                        product.quantity -= item.quantity;
                    }
                });
                
                // Adicionar ao histórico do cliente
                if (currentCart.customer) {
                    const customer = db.customers.find(c => c.id === currentCart.customer.id);
                    if (customer) {
                        customer.purchases.unshift({
                            id: newSale.id,
                            date: newSale.date,
                            total: newSale.total,
                            paymentMethod: newSale.paymentMethod
                        });
                    }
                }
                
                saveData();
                
                // Limpar carrinho
                currentCart = {
                    items: [],
                    discount: 0,
                    paymentMethod: 'Dinheiro',
                    customer: null
                };
                
                updateCart();
                document.getElementById('customer-search').value = '';
                document.getElementById('discount-input').value = '';
                
                // Mostrar recibo
                showReceipt(newSale);
            });
        }

        // Adicionar produto ao carrinho
        function addToCart(product) {
            const existingItem = currentCart.items.find(item => item.id === product.id);
            
            if (existingItem) {
                if (existingItem.quantity < product.quantity) {
                    existingItem.quantity += 1;
                } else {
                    alert('Quantidade em estoque insuficiente');
                }
            } else {
                if (product.quantity > 0) {
                    currentCart.items.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        quantity: 1
                    });
                } else {
                    alert('Produto sem estoque disponível');
                }
            }
            
            updateCart();
        }

        // Atualizar carrinho
        function updateCart() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '';
            
            currentCart.items.forEach(item => {
                const product = db.products.find(p => p.id === item.id);
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <span>${item.name}</span>
                        <button class="btn btn-secondary" onclick="decreaseQuantity(${item.id})">-</button>
                        <span class="cart-item-quantity">${item.quantity}</span>
                        <button class="btn btn-secondary" onclick="increaseQuantity(${item.id})">+</button>
                    </div>
                    <div class="cart-item-price">${formatCurrency(item.price * item.quantity)}</div>
                    <i class="fas fa-times cart-item-remove" onclick="removeFromCart(${item.id})"></i>
                `;
                cartItems.appendChild(cartItem);
            });
            
            const total = currentCart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const finalTotal = total - currentCart.discount;
            
            document.getElementById('cart-total').textContent = formatCurrency(finalTotal);
        }

        // Funções globais para manipulação do carrinho
        window.increaseQuantity = function(productId) {
            const item = currentCart.items.find(item => item.id === productId);
            const product = db.products.find(p => p.id === productId);
            
            if (item && product) {
                if (item.quantity < product.quantity) {
                    item.quantity += 1;
                    updateCart();
                } else {
                    alert('Quantidade em estoque insuficiente');
                }
            }
        };

        window.decreaseQuantity = function(productId) {
            const item = currentCart.items.find(item => item.id === productId);
            
            if (item) {
                if (item.quantity > 1) {
                    item.quantity -= 1;
                } else {
                    removeFromCart(productId);
                }
                updateCart();
            }
        };

        window.removeFromCart = function(productId) {
            currentCart.items = currentCart.items.filter(item => item.id !== productId);
            updateCart();
        };

        // Mostrar recibo
        function showReceipt(sale) {
            document.getElementById('receipt-id').textContent = sale.id;
            document.getElementById('receipt-date').textContent = formatDateTime(sale.date);
            document.getElementById('receipt-customer').textContent = sale.customer ? sale.customer.name : 'Consumidor Final';
            document.getElementById('receipt-payment').textContent = sale.paymentMethod;
            
            const receiptItems = document.getElementById('receipt-items');
            receiptItems.innerHTML = '';
            
            sale.items.forEach(item => {
                const itemRow = document.createElement('div');
                itemRow.className = 'receipt-item';
                itemRow.innerHTML = `
                    <span>${item.quantity}x ${item.name}</span>
                    <span>${formatCurrency(item.price * item.quantity)}</span>
                `;
                receiptItems.appendChild(itemRow);
            });
            
            if (sale.discount > 0) {
                const discountRow = document.createElement('div');
                discountRow.className = 'receipt-item';
                discountRow.innerHTML = `
                    <span>Desconto</span>
                    <span>-${formatCurrency(sale.discount)}</span>
                `;
                receiptItems.appendChild(discountRow);
            }
            
            document.getElementById('receipt-total').textContent = formatCurrency(sale.total);
            
            // Mostrar modal
            document.getElementById('receipt-modal').style.display = 'flex';
        }

        // Imprimir recibo
        document.getElementById('print-receipt').addEventListener('click', function() {
            const printContent = document.getElementById('receipt-content').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            
            // Recarregar eventos
            updateSalesSection();
        });

        // Seção de Clientes
        function updateCustomersSection() {
            // Atualizar tabela de clientes
            const customersTable = document.getElementById('customers-table').querySelector('tbody');
            customersTable.innerHTML = '';
            
            db.customers.forEach(customer => {
                const totalPurchases = customer.purchases ? customer.purchases.reduce((total, purchase) => total + purchase.total, 0) : 0;
                
                const row = document.createElement('tr');
                row.setAttribute('data-id', customer.id);
                row.innerHTML = `
                    <td>${customer.name}</td>
                    <td>${customer.phone ? formatPhone(customer.phone) : '-'}</td>
                    <td>${customer.cpf ? formatCPF(customer.cpf) : '-'}</td>
                    <td>${formatCurrency(totalPurchases)}</td>
                    <td>
                        <button class="action-btn edit" data-id="${customer.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete" data-id="${customer.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                customersTable.appendChild(row);
            });
            
            // Busca de clientes
            document.getElementById('customer-table-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                document.querySelectorAll('#customers-table tbody tr').forEach(row => {
                    const customerName = row.querySelector('td:first-child').textContent.toLowerCase();
                    if (customerName.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
            
            // Adicionar cliente
            document.getElementById('add-customer-btn').addEventListener('click', function() {
                document.getElementById('new-customer-modal').style.display = 'flex';
                document.getElementById('customer-name').value = '';
                document.getElementById('customer-phone').value = '';
                document.getElementById('customer-cpf').value = '';
                document.getElementById('customer-notes').value = '';
            });
            
            // Editar cliente
            document.querySelectorAll('#customers-table .action-btn.edit').forEach(button => {
                button.addEventListener('click', function() {
                    const customerId = parseInt(this.getAttribute('data-id'));
                    const customer = db.customers.find(c => c.id === customerId);
                    
                    if (customer) {
                        showCustomerDetails(customer);
                    }
                });
            });
            
            // Excluir cliente
            document.querySelectorAll('#customers-table .action-btn.delete').forEach(button => {
                button.addEventListener('click', function() {
                    const customerId = parseInt(this.getAttribute('data-id'));
                    
                    if (confirm('Tem certeza que deseja excluir este cliente?')) {
                        db.customers = db.customers.filter(c => c.id !== customerId);
                        saveData();
                        updateCustomersSection();
                    }
                });
            });
        }

        // Mostrar detalhes do cliente
        function showCustomerDetails(customer) {
            document.getElementById('edit-customer-name').value = customer.name;
            document.getElementById('edit-customer-phone').value = customer.phone ? formatPhone(customer.phone) : '';
            document.getElementById('edit-customer-cpf').value = customer.cpf ? formatCPF(customer.cpf) : '';
            document.getElementById('edit-customer-notes').value = customer.notes || '';
            
            // Aplicar máscaras aos campos de edição
            applyPhoneMask(document.getElementById('edit-customer-phone'));
            applyCPFMask(document.getElementById('edit-customer-cpf'));
            
            // Atualizar histórico de compras
            const purchasesList = document.getElementById('customer-purchases-list');
            purchasesList.innerHTML = '';
            
            if (customer.purchases && customer.purchases.length > 0) {
                customer.purchases.forEach(purchase => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatDate(purchase.date)}</td>
                        <td>${purchase.id}</td>
                        <td>${formatCurrency(purchase.total)}</td>
                        <td>${purchase.paymentMethod}</td>
                    `;
                    purchasesList.appendChild(row);
                });
            } else {
                purchasesList.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nenhuma compra registrada</td></tr>';
            }
            
            // Atualizar histórico de serviços
            const servicesList = document.getElementById('customer-services-list');
            servicesList.innerHTML = '';
            
            if (customer.serviceOrders && customer.serviceOrders.length > 0) {
                customer.serviceOrders.forEach(service => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatDate(service.date)}</td>
                        <td>${service.id}</td>
                        <td>${service.problem.substring(0, 30)}...</td>
                        <td>${formatCurrency(service.estimatedValue)}</td>
                        <td><span class="status ${service.status === 'completed' ? 'completed' : service.status === 'canceled' ? 'canceled' : 'pending'}">
                            ${service.status === 'completed' ? 'Concluído' : service.status === 'canceled' ? 'Cancelado' : 'Pendente'}
                        </span></td>
                    `;
                    servicesList.appendChild(row);
                });
            } else {
                servicesList.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhuma ordem de serviço registrada</td></tr>';
            }
            
            // Abrir modal
            const modal = document.getElementById('customer-details-modal');
            modal.style.display = 'flex';
            modal.setAttribute('data-customer-id', customer.id);
            
            // Tabs
            document.querySelectorAll('#customer-details-modal .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('#customer-details-modal .tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('#customer-details-modal .tab-content').forEach(c => c.style.display = 'none');
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`customer-tab-${tabId}`).style.display = 'block';
                });
            });
            
            // Atualizar cliente
            document.getElementById('update-customer-btn').addEventListener('click', function() {
                const customerId = parseInt(modal.getAttribute('data-customer-id'));
                const customer = db.customers.find(c => c.id === customerId);
                
                if (customer) {
                    customer.name = document.getElementById('edit-customer-name').value;
                    customer.phone = document.getElementById('edit-customer-phone').value;
                    customer.cpf = document.getElementById('edit-customer-cpf').value;
                    customer.notes = document.getElementById('edit-customer-notes').value;
                    
                    saveData();
                    updateCustomersSection();
                    modal.style.display = 'none';
                    alert('Cliente atualizado com sucesso!');
                }
            });
            
            // Excluir cliente
            document.getElementById('delete-customer-btn').addEventListener('click', function() {
                const customerId = parseInt(modal.getAttribute('data-customer-id'));
                
                if (confirm('Tem certeza que deseja excluir este cliente?')) {
                    db.customers = db.customers.filter(c => c.id !== customerId);
                    saveData();
                    updateCustomersSection();
                    modal.style.display = 'none';
                }
            });
        }

        // Seção de Produtos
        function updateProductsSection() {
            // Atualizar tabela de produtos
            const productsTable = document.getElementById('products-table').querySelector('tbody');
            productsTable.innerHTML = '';
            
            db.products.forEach(product => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', product.id);
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.quantity}</td>
                    <td>${product.idealQuantity}</td>
                    <td>${formatCurrency(product.cost)}</td>
                    <td>${formatCurrency(product.price)}</td>
                    <td>
                        <button class="action-btn edit" data-id="${product.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete" data-id="${product.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                productsTable.appendChild(row);
            });
            
            // Atualizar tabela de estoque baixo
            const lowStockTable = document.getElementById('low-stock-table').querySelector('tbody');
            lowStockTable.innerHTML = '';
            
            const lowStockProducts = db.products.filter(product => product.quantity < product.idealQuantity);
            
            if (lowStockProducts.length > 0) {
                lowStockProducts.forEach(product => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.name}</td>
                        <td>${product.quantity}</td>
                        <td>${product.idealQuantity}</td>
                        <td>${product.idealQuantity - product.quantity}</td>
                    `;
                    lowStockTable.appendChild(row);
                });
            } else {
                lowStockTable.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nenhum produto com estoque baixo</td></tr>';
            }
            
            // Busca de produtos
            document.getElementById('product-table-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                document.querySelectorAll('#products-table tbody tr').forEach(row => {
                    const productName = row.querySelector('td:first-child').textContent.toLowerCase();
                    if (productName.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
            
            // Adicionar produto
            document.getElementById('add-product-btn').addEventListener('click', function() {
                document.getElementById('product-modal-title').textContent = 'Adicionar Produto';
                document.getElementById('product-name').value = '';
                document.getElementById('product-quantity').value = '';
                document.getElementById('product-ideal-quantity').value = '';
                document.getElementById('product-cost').value = '';
                document.getElementById('product-price').value = '';
                document.getElementById('product-modal').setAttribute('data-mode', 'add');
                document.getElementById('product-modal').style.display = 'flex';
            });
            
            // Editar produto
            document.querySelectorAll('#products-table .action-btn.edit').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const product = db.products.find(p => p.id === productId);
                    
                    if (product) {
                        document.getElementById('product-modal-title').textContent = 'Editar Produto';
                        document.getElementById('product-name').value = product.name;
                        document.getElementById('product-quantity').value = product.quantity;
                        document.getElementById('product-ideal-quantity').value = product.idealQuantity;
                        document.getElementById('product-cost').value = formatCurrency(product.cost);
                        document.getElementById('product-price').value = formatCurrency(product.price);
                        document.getElementById('product-modal').setAttribute('data-product-id', product.id);
                        document.getElementById('product-modal').setAttribute('data-mode', 'edit');
                        document.getElementById('product-modal').style.display = 'flex';
                    }
                });
            });
            
            // Excluir produto
            document.querySelectorAll('#products-table .action-btn.delete').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    
                    if (confirm('Tem certeza que deseja excluir este produto?')) {
                        db.products = db.products.filter(p => p.id !== productId);
                        saveData();
                        updateProductsSection();
                    }
                });
            });
            
            // Salvar produto
            document.getElementById('save-product').addEventListener('click', function() {
                const modal = document.getElementById('product-modal');
                const mode = modal.getAttribute('data-mode');
                const name = document.getElementById('product-name').value;
                const quantity = parseInt(document.getElementById('product-quantity').value) || 0;
                const idealQuantity = parseInt(document.getElementById('product-ideal-quantity').value) || 0;
                const cost = parseFloat(document.getElementById('product-cost').value.replace('R$', '').replace('.', '').replace(',', '.').trim()) || 0;
                const price = parseFloat(document.getElementById('product-price').value.replace('R$', '').replace('.', '').replace(',', '.').trim()) || 0;
                
                if (!name) {
                    alert('Por favor, informe o nome do produto');
                    return;
                }
                
                if (mode === 'add') {
                    const newProduct = {
                        id: generateId(),
                        name,
                        quantity,
                        idealQuantity,
                        cost,
                        price
                    };
                    
                    db.products.push(newProduct);
                    alert('Produto cadastrado com sucesso!');
                } else {
                    const productId = parseInt(modal.getAttribute('data-product-id'));
                    const product = db.products.find(p => p.id === productId);
                    
                    if (product) {
                        product.name = name;
                        product.quantity = quantity;
                        product.idealQuantity = idealQuantity;
                        product.cost = cost;
                        product.price = price;
                        alert('Produto atualizado com sucesso!');
                    }
                }
                
                saveData();
                updateProductsSection();
                modal.style.display = 'none';
            });
            
            // Formatar moeda nos inputs
            document.getElementById('product-cost').addEventListener('blur', function() {
                const value = parseFloat(this.value.replace('R$', '').replace('.', '').replace(',', '.').trim()) || 0;
                this.value = formatCurrency(value);
            });
            
            document.getElementById('product-price').addEventListener('blur', function() {
                const value = parseFloat(this.value.replace('R$', '').replace('.', '').replace(',', '.').trim()) || 0;
                this.value = formatCurrency(value);
            });
        }

        // Seção de Ordens de Serviço
        function updateServiceOrdersSection() {
            // Atualizar tabela de ordens de serviço
            const serviceOrdersTable = document.getElementById('service-orders-table').querySelector('tbody');
            serviceOrdersTable.innerHTML = '';
            
            db.serviceOrders.forEach(order => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', order.id);
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.customer.name}</td>
                    <td>${order.problem.substring(0, 30)}${order.problem.length > 30 ? '...' : ''}</td>
                    <td>${formatDate(order.date)}</td>
                    <td>${formatCurrency(order.estimatedValue)}</td>
                    <td><span class="status ${order.status === 'completed' ? 'completed' : order.status === 'canceled' ? 'canceled' : 'pending'}">
                        ${order.status === 'completed' ? 'Concluído' : order.status === 'canceled' ? 'Cancelado' : 'Pendente'}
                    </span></td>
                    <td>
                        <button class="action-btn edit" data-id="${order.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete" data-id="${order.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                serviceOrdersTable.appendChild(row);
            });
            
            // Busca de ordens de serviço
            document.getElementById('service-order-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                document.querySelectorAll('#service-orders-table tbody tr').forEach(row => {
                    const customerName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                    const problem = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                    if (customerName.includes(searchTerm) || problem.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
            
            // Nova ordem de serviço
            document.getElementById('add-service-order-btn').addEventListener('click', function() {
                document.getElementById('service-order-modal-title').textContent = 'Nova Ordem de Serviço';
                document.getElementById('service-order-customer-search').value = '';
                document.getElementById('service-order-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('service-order-problem').value = '';
                document.getElementById('service-order-items').value = '';
                document.getElementById('service-order-estimated-value').value = '';
                document.getElementById('service-order-deadline').value = '';
                document.getElementById('service-order-status').value = 'pending';
                document.getElementById('service-order-modal').setAttribute('data-mode', 'add');
                document.getElementById('print-service-order').style.display = 'none';
                document.getElementById('service-order-modal').style.display = 'flex';
            });
            
            // Busca de cliente na ordem de serviço
            document.getElementById('service-order-customer-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const resultsContainer = document.getElementById('service-order-customer-search-results');
                
                if (searchTerm.length < 2) {
                    resultsContainer.style.display = 'none';
                    return;
                }
                
                const filteredCustomers = db.customers.filter(customer => 
                    customer.name.toLowerCase().includes(searchTerm) || 
                    (customer.phone && customer.phone.includes(searchTerm)) ||
                    (customer.cpf && customer.cpf.includes(searchTerm))
                );
                
                if (filteredCustomers.length > 0) {
                    resultsContainer.innerHTML = '';
                    filteredCustomers.forEach(customer => {
                        const div = document.createElement('div');
                        div.className = 'product-item';
                        div.style.padding = '10px';
                        div.style.cursor = 'pointer';
                        div.innerHTML = `
                            <div class="product-info">
                                <h4>${customer.name}</h4>
                                <p>${customer.phone || ''} ${customer.cpf || ''}</p>
                            </div>
                        `;
                        div.addEventListener('click', function() {
                            document.getElementById('service-order-customer-search').value = customer.name;
                            document.getElementById('service-order-modal').setAttribute('data-customer-id', customer.id);
                            resultsContainer.style.display = 'none';
                        });
                        resultsContainer.appendChild(div);
                    });
                    resultsContainer.style.display = 'block';
                } else {
                    resultsContainer.innerHTML = '<div style="padding: 10px;">Nenhum cliente encontrado</div>';
                    resultsContainer.style.display = 'block';
                }
            });
            
            // Novo cliente na ordem de serviço
            document.getElementById('service-order-new-customer-btn').addEventListener('click', function() {
                document.getElementById('new-customer-modal').style.display = 'flex';
            });
            
            // Editar ordem de serviço
            document.querySelectorAll('#service-orders-table .action-btn.edit').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = parseInt(this.getAttribute('data-id'));
                    const order = db.serviceOrders.find(o => o.id === orderId);
                    
                    if (order) {
                        document.getElementById('service-order-modal-title').textContent = 'Editar Ordem de Serviço';
                        document.getElementById('service-order-customer-search').value = order.customer.name;
                        document.getElementById('service-order-modal').setAttribute('data-customer-id', order.customer.id);
                        document.getElementById('service-order-date').value = order.date.split('T')[0];
                        document.getElementById('service-order-problem').value = order.problem;
                        document.getElementById('service-order-items').value = order.items;
                        document.getElementById('service-order-estimated-value').value = formatCurrency(order.estimatedValue);
                        document.getElementById('service-order-deadline').value = order.deadline;
                        document.getElementById('service-order-status').value = order.status;
                        document.getElementById('service-order-modal').setAttribute('data-order-id', order.id);
                        document.getElementById('service-order-modal').setAttribute('data-mode', 'edit');
                        document.getElementById('print-service-order').style.display = 'inline-block';
                        document.getElementById('service-order-modal').style.display = 'flex';
                    }
                });
            });
            
            // Excluir ordem de serviço
            document.querySelectorAll('#service-orders-table .action-btn.delete').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = parseInt(this.getAttribute('data-id'));
                    
                    if (confirm('Tem certeza que deseja excluir esta ordem de serviço?')) {
                        db.serviceOrders = db.serviceOrders.filter(o => o.id !== orderId);
                        saveData();
                        updateServiceOrdersSection();
                    }
                });
            });
            
            // Salvar ordem de serviço
            document.getElementById('save-service-order').addEventListener('click', function() {
                const modal = document.getElementById('service-order-modal');
                const mode = modal.getAttribute('data-mode');
                const customerId = parseInt(modal.getAttribute('data-customer-id'));
                const customer = db.customers.find(c => c.id === customerId);
                const date = document.getElementById('service-order-date').value;
                const problem = document.getElementById('service-order-problem').value;
                const items = document.getElementById('service-order-items').value;
                const estimatedValue = parseFloat(document.getElementById('service-order-estimated-value').value.replace('R$', '').replace('.', '').replace(',', '.').trim()) || 0;
                const deadline = document.getElementById('service-order-deadline').value;
                const status = document.getElementById('service-order-status').value;
                
                if (!customer) {
                    alert('Por favor, selecione um cliente');
                    return;
                }
                
                if (!problem) {
                    alert('Por favor, descreva o problema');
                    return;
                }
                
                if (mode === 'add') {
                    const newOrder = {
                        id: generateId(),
                        customer,
                        date: new Date(date).toISOString(),
                        problem,
                        items,
                        estimatedValue,
                        deadline,
                        status
                    };
                    
                    db.serviceOrders.unshift(newOrder);
                    
                    // Adicionar ao histórico do cliente
                    customer.serviceOrders = customer.serviceOrders || [];
                    customer.serviceOrders.unshift({
                        id: newOrder.id,
                        date: newOrder.date,
                        problem: newOrder.problem,
                        estimatedValue: newOrder.estimatedValue,
                        status: newOrder.status
                    });

                    alert('Ordem de serviço cadastrada com sucesso!');
                } else {
                    const orderId = parseInt(modal.getAttribute('data-order-id'));
                    const order = db.serviceOrders.find(o => o.id === orderId);
                    
                    if (order) {
                        // Remover do histórico do cliente antigo
                        const oldCustomer = order.customer;
                        if (oldCustomer.id !== customerId) {
                            oldCustomer.serviceOrders = oldCustomer.serviceOrders.filter(so => so.id !== order.id);
                            
                            // Adicionar ao novo cliente
                            customer.serviceOrders = customer.serviceOrders || [];
                            customer.serviceOrders.unshift({
                                id: order.id,
                                date: date,
                                problem: problem,
                                estimatedValue: estimatedValue,
                                status: status
                            });
                        } else {
                            // Atualizar no histórico do cliente
                            const customerOrder = customer.serviceOrders.find(so => so.id === order.id);
                            if (customerOrder) {
                                customerOrder.date = date;
                                customerOrder.problem = problem;
                                customerOrder.estimatedValue = estimatedValue;
                                customerOrder.status = status;
                            }
                        }
                        
                        order.customer = customer;
                        order.date = new Date(date).toISOString();
                        order.problem = problem;
                        order.items = items;
                        order.estimatedValue = estimatedValue;
                        order.deadline = deadline;
                        order.status = status;

                        alert('Ordem de serviço atualizada com sucesso!');
                    }
                }
                
                saveData();
                updateServiceOrdersSection();
                modal.style.display = 'none';
            });
            
            // Imprimir ordem de serviço
            document.getElementById('print-service-order').addEventListener('click', function() {
                const orderId = parseInt(document.getElementById('service-order-modal').getAttribute('data-order-id'));
                const order = db.serviceOrders.find(o => o.id === orderId);
                
                if (order) {
                    document.getElementById('print-os-id').textContent = order.id;
                    document.getElementById('print-customer-name').textContent = order.customer.name;
                    document.getElementById('print-customer-phone').textContent = order.customer.phone ? formatPhone(order.customer.phone) : '';
                    document.getElementById('print-customer-cpf').textContent = order.customer.cpf ? formatCPF(order.customer.cpf) : '';
                    document.getElementById('print-os-date').textContent = formatDate(order.date);
                    document.getElementById('print-os-deadline').textContent = order.deadline ? formatDate(order.deadline) : '';
                    document.getElementById('print-os-status').textContent = 
                        order.status === 'completed' ? 'Concluído' : 
                        order.status === 'canceled' ? 'Cancelado' : 'Pendente';
                    document.getElementById('print-os-value').textContent = formatCurrency(order.estimatedValue);
                    document.getElementById('print-os-problem').textContent = order.problem;
                    document.getElementById('print-os-items').textContent = order.items;
                    document.getElementById('print-customer-name-footer').textContent = order.customer.name;
                    
                    document.getElementById('service-order-print-modal').style.display = 'flex';
                }
            });
            
            // Botão de impressão na modal de visualização
            document.getElementById('print-service-order-btn').addEventListener('click', function() {
                const printContent = document.getElementById('service-order-print-content').innerHTML;
                const originalContent = document.body.innerHTML;
                
                document.body.innerHTML = printContent;
                window.print();
                document.body.innerHTML = originalContent;
                
                // Recarregar eventos
                updateServiceOrdersSection();
            });
            
            // Formatar moeda no input de valor estimado
            document.getElementById('service-order-estimated-value').addEventListener('blur', function() {
                const value = parseFloat(this.value.replace('R$', '').replace('.', '').replace(',', '.').trim()) || 0;
                this.value = formatCurrency(value);
            });
        }

        // Inicializar a seção Dashboard
        updateDashboard();

        // Aplicar máscaras aos campos de telefone existentes
        document.querySelectorAll('.phone-mask').forEach(input => {
            applyPhoneMask(input);
        });

        // Aplicar máscaras aos campos de CPF existentes
        document.querySelectorAll('input[placeholder="000.000.000-00"]').forEach(input => {
            applyCPFMask(input);
        });
    </script>
</body>
</html>